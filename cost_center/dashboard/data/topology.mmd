%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#2563eb', 'primaryTextColor': '#fff', 'primaryBorderColor': '#1e40af', 'lineColor': '#64748b', 'secondaryColor': '#f8fafc', 'tertiaryColor': '#e2e8f0'}}}%%
flowchart TB
    subgraph LEGEND["Legend"]
        direction LR
        L1[ðŸ¢ Tenant]
        L2[ðŸ“¦ Subscription]
        L3[ðŸ—‚ï¸ Resource Group]
        L4[ðŸ”— Identity Flow]
        L5[ðŸ“Š Data Flow]
        L6[ðŸŒ Network Flow]
    end

    subgraph HTT["ðŸ¢ HTT Brands (Anchor Tenant)"]
        direction TB
        subgraph HTT_CORE["ðŸ“¦ HTT-CORE ($186/mo)"]
            direction TB
            NC["ðŸ—‚ï¸ network-core"]
            NC --> FW["ðŸ”¥ Azure Firewall"]
            NC --> VNET["ðŸŒ VNet Hub"]
            
            MON["ðŸ—‚ï¸ htt-monitoring"]
            MON --> LOGS["ðŸ“ Network Logs"]
            
            DEF["ðŸ—‚ï¸ hhtdefaultgroup"]
            DEF --> SYNTEX["ðŸ§  Syntex ($110)"]
        end
        
        subgraph HTT_DEV["ðŸ“¦ Dev/Test ($83/mo)"]
            direction TB
            BIDEV["ðŸ—‚ï¸ htt-bi-dev"]
            BIDEV --> VM["ðŸ’» SQL Import VM"]
            BIDEV --> ADF["âš™ï¸ Data Factory"]
            BIDEV --> STORAGE["ðŸ’¾ Data Lake"]
            BIDEV --> DNS["ðŸ”’ Private DNS"]
            
            IDDEV["ðŸ—‚ï¸ htt-identity-dev"]
            IDDEV --> B2B["ðŸ‘¥ B2B External ID"]
        end
        
        subgraph HTT_FABRIC["ðŸ“¦ HTT-FABRIC-PROD"]
            direction TB
            FABRIC["ðŸ“Š Power BI / Fabric"]
        end
        
        subgraph HTT_WEB["ðŸ“¦ HTT-Web-Integrations"]
            direction TB
            SWA["ðŸŒ Static Web Apps"]
        end
    end
    
    subgraph BCC["ðŸ¢ Bishops (Spoke)"]
        direction TB
        subgraph BCC_CORE["ðŸ“¦ BCC-CORE"]
            BCC_RES["ðŸ—‚ï¸ Resources"]
        end
    end
    
    subgraph FN["ðŸ¢ Frenchies (Spoke)"]
        direction TB
        subgraph FN_CORE["ðŸ“¦ FN-CORE"]
            FN_TENANT["ðŸ—‚ï¸ htt-tenant"]
            FN_TENANT --> FN_GUEST["ðŸ‘¤ Guest Usage"]
        end
    end
    
    subgraph TLL["ðŸ¢ The Lash Lounge (Spoke)"]
        direction TB
        subgraph TLL_CORE["ðŸ“¦ TLL-CORE"]
            TLL_RES["ðŸ—‚ï¸ Resources"]
        end
    end
    
    subgraph GITHUB["ðŸ™ GitHub"]
        direction TB
        GH_HTT["HTT-BRANDS"]
        GH_BCC["BishopsCutBarbershop"]
        GH_FN["FrenchiestheBrand"]
        GH_TLL["TLL-CORP"]
    end

    %% Identity Flows (Blue dashed)
    B2B -.->|"ðŸ”— B2B Guest"| BCC
    B2B -.->|"ðŸ”— B2B Guest"| FN
    B2B -.->|"ðŸ”— B2B Guest"| TLL
    
    %% Data Flows (Green solid)
    BCC_RES -->|"ðŸ“Š ETL"| ADF
    FN_GUEST -->|"ðŸ“Š ETL"| ADF
    TLL_RES -->|"ðŸ“Š ETL"| ADF
    ADF -->|"ðŸ“Š Transform"| STORAGE
    STORAGE -->|"ðŸ“Š Analytics"| FABRIC
    
    %% Network Flows (Orange)
    FW ===|"ðŸŒ Hub-Spoke"| BCC
    FW ===|"ðŸŒ Hub-Spoke"| FN
    FW ===|"ðŸŒ Hub-Spoke"| TLL
    
    %% GitHub CI/CD (Purple)
    GH_HTT -->|"ðŸš€ Deploy"| SWA
    GH_HTT -->|"ðŸš€ CI/CD"| HTT
    GH_BCC -->|"ðŸš€ CI/CD"| BCC
    GH_FN -->|"ðŸš€ CI/CD"| FN
    GH_TLL -->|"ðŸš€ CI/CD"| TLL

    %% Styling
    classDef anchor fill:#2563eb,stroke:#1e40af,color:#fff
    classDef spoke fill:#64748b,stroke:#475569,color:#fff
    classDef rg fill:#f1f5f9,stroke:#cbd5e1,color:#334155
    classDef resource fill:#fff,stroke:#e2e8f0,color:#334155
    classDef github fill:#24292f,stroke:#1b1f23,color:#fff
    
    class HTT anchor
    class BCC,FN,TLL spoke
    class NC,MON,DEF,BIDEV,IDDEV,BCC_RES,FN_TENANT,TLL_RES rg
    class FW,VNET,LOGS,SYNTEX,VM,ADF,STORAGE,DNS,B2B,FABRIC,SWA,FN_GUEST resource
    class GITHUB,GH_HTT,GH_BCC,GH_FN,GH_TLL github